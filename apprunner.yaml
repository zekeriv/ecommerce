version: 1.0
runtime: nodejs22
build:
  commands:
    build:
      - echo "Node version:"
      - node --version
      - echo "NPM version:"
      - npm --version
      - echo "Starting build process..."
      - ls -la
      - echo "Building backend..."
      - cd backend && npm install --production
      - echo "Building frontend..."
      - cd ../frontend && npm install && npm run build
      - echo "Building admin..."
      - cd ../admin && npm install && npm run build
      - echo "Setting up directories..."
      - cd .. && mkdir -p backend/public
      - echo "Copying frontend build..."
      - cp -r frontend/build backend/public/frontend || echo "Frontend build copy failed"
      - echo "Copying admin build..."
      - cp -r admin/build backend/public/admin || echo "Admin build copy failed"
      - echo "Listing backend/public contents:"
      - ls -la backend/public/
      - echo "Build complete!"
run:
  runtime-version: 22
  command: cd backend && npm start
  network:
    port: 4000
  env:
    - name: NODE_ENV
      value: production